"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var reactNative=require("react-native"),React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),mitt=_interopDefault(require("mitt")),XHRInterceptor=_interopDefault(require("react-native/Libraries/Network/XHRInterceptor")),reactotronCoreClient=require("reactotron-core-client"),parseErrorStack=void 0,symbolicateStackTrace=void 0,PLUGIN_DEFAULTS={veto:null},trackGlobalErrors=function(e){return function(t){var r=Object.assign({},PLUGIN_DEFAULTS,e||{}),n=null,o=!1;function a(e,o,a){n(e,o,a);try{var i=o.map(function(e){return{functionName:"<unknown>"===e.methodName?null:e.methodName,lineNumber:e.lineNumber,columnNumber:e.column,fileName:e.file}});r.veto&&(i=i.filter(function(e){return r.veto(e)})),t.error(e,i)}catch(e){}}function i(){o||reactNative.NativeModules.ExceptionsManager&&(n=reactNative.NativeModules.ExceptionsManager.updateExceptionMessage,reactNative.NativeModules.ExceptionsManager.updateExceptionMessage=a,o=!0)}return i(),{features:{reportError:function(e){try{if(parseErrorStack=parseErrorStack||require("react-native/Libraries/Core/Devtools/parseErrorStack"),symbolicateStackTrace=symbolicateStackTrace||require("react-native/Libraries/Core/Devtools/symbolicateStackTrace"),parseErrorStack&&symbolicateStackTrace){var n=parseErrorStack(e);symbolicateStackTrace(n).then(function(n){var o=n.map(function(e){return{fileName:e.file,functionName:e.methodName,lineNumber:e.lineNumber}});r.veto&&(o=o.filter(function(e){return r.veto(e)})),t.error(e.message,o)})}}catch(e){}},trackGlobalErrors:i,untrackGlobalErrors:function(){n&&reactNative.NativeModules.ExceptionsManager&&(reactNative.NativeModules.ExceptionsManager.updateExceptionMessage=n,o=!1)}}}}},DEFAULTS$1={url:"http://localhost:8081"},openInEditor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var r=Object.assign({},DEFAULTS$1,e);return{onCommand:function(e){if("editor.open"===e.type){var t=e.payload,n=t.file,o=t.lineNumber,a=r.url+"/open-stack-frame",i={file:n,lineNumber:o||1};fetch(a,{method:"POST",body:JSON.stringify(i)})}}}}},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Styles={container:{position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:1e3,opacity:.25}},FullScreenOverlay=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={opacity:Styles.container.opacity,uri:null,justifyContent:"center",alignItems:"center"},e.emitter.on("overlay",function(e){r.setState(_extends({},r.state,e))}),r}return inherits(t,e),createClass(t,[{key:"createContainerStyle",value:function(){var e=this.state,t=e.opacity,r=e.justifyContent,n=e.alignItems,o=reactNative.Dimensions.get("window"),a=o.width,i=o.height;return _extends({},Styles.container,{opacity:t,width:a,height:i,justifyContent:r,alignItems:n})}},{key:"render",value:function(){var e=this.state,t=e.uri,r=e.width,n=e.height,o=e.growToWindow,a=e.resizeMode,i=e.marginLeft,c=void 0===i?0:i,s=e.marginRight,u=void 0===s?0:s,l=e.marginTop,f=void 0===l?0:l,p=e.marginBottom,v={width:r,height:n,marginTop:f,marginRight:u,marginBottom:void 0===p?0:p,marginLeft:c};if(o){var m=reactNative.Dimensions.get("window");v.width=m.width,v.height=m.height}var d=t?React__default.createElement(reactNative.Image,{source:{uri:t},style:v,resizeMode:o?a:null}):React__default.createElement(reactNative.View,null);return React__default.createElement(reactNative.View,{style:this.createContainerStyle(),pointerEvents:"none"},d)}}]),t}(React.Component);FullScreenOverlay.propTypes={emitter:PropTypes.object.isRequired};var overlay=function(){return function(e){var t=mitt();return{onCommand:function(e){"overlay"===e.type&&t.emit("overlay",e.payload)},features:{overlay:function(e){return function(r){return React__default.createElement(reactNative.View,{style:{flex:1}},React__default.createElement(e,r),React__default.createElement(FullScreenOverlay,{emitter:t}))}}}}}},_this$1=void 0,PLUGIN_DEFAULTS$1={ignore:[]},asyncStorage=function(e){return function(t){var r,n,o,a,i,c,s,u=Object.assign({},PLUGIN_DEFAULTS$1,e||{}).ignore||PLUGIN_DEFAULTS$1.ignore,l=void 0,f=void 0,p=void 0,v=void 0,m=void 0,d=void 0,y=void 0,g=!1,h=function(e,r){t.send("asyncStorage.mutation",{action:e,data:r})},N=(r=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{u.indexOf(t)<0&&h("setItem",{key:t,value:r})}catch(e){}return e.abrupt("return",l(t,r,n));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t,n){return r.apply(this,arguments)}),b=(n=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{u.indexOf(t)<0&&h("removeItem",{key:t})}catch(e){}return e.abrupt("return",f(t,r));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t){return n.apply(this,arguments)}),S=(o=asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{u.indexOf(t)<0&&h("mergeItem",{key:t,value:r})}catch(e){}return e.abrupt("return",p(t,r,n));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t,r){return o.apply(this,arguments)}),_=(a=asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{h("clear")}catch(e){}return e.abrupt("return",v(t));case 2:case"end":return e.stop()}},e,_this$1)})),function(e){return a.apply(this,arguments)}),w=(i=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{(n=(t||[]).filter(function(e){return e&&e[0]&&u.indexOf(e[0])<0})).length>0&&h("multiSet",{pairs:n})}catch(e){}return e.abrupt("return",m(t,r));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t){return i.apply(this,arguments)}),k=(c=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{(n=(t||[]).filter(function(e){return u.indexOf(e)<0})).length>0&&h("multiRemove",{keys:n})}catch(e){}return e.abrupt("return",d(t,r));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t){return c.apply(this,arguments)}),R=(s=asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{(n=(t||[]).filter(function(e){return e&&e[0]&&u.indexOf(e[0])<0})).length>0&&h("multiMerge",{pairs:n})}catch(e){}return e.abrupt("return",y(t,r));case 2:case"end":return e.stop()}},e,_this$1)})),function(e,t){return s.apply(this,arguments)}),E=function(){g||(l=reactNative.AsyncStorage.setItem,reactNative.AsyncStorage.setItem=N,f=reactNative.AsyncStorage.removeItem,reactNative.AsyncStorage.removeItem=b,p=reactNative.AsyncStorage.mergeItem,reactNative.AsyncStorage.mergeItem=S,v=reactNative.AsyncStorage.clear,reactNative.AsyncStorage.clear=_,m=reactNative.AsyncStorage.multiSet,reactNative.AsyncStorage.multiSet=w,d=reactNative.AsyncStorage.multiRemove,reactNative.AsyncStorage.multiRemove=k,y=reactNative.AsyncStorage.multiMerge,reactNative.AsyncStorage.multiMerge=R,g=!0)};return E(),{features:{trackAsyncStorage:E,untrackAsyncStorage:function(){g&&(reactNative.AsyncStorage.setItem=l,reactNative.AsyncStorage.removeItem=f,reactNative.AsyncStorage.mergeItem=p,reactNative.AsyncStorage.clear=v,reactNative.AsyncStorage.multiSet=m,reactNative.AsyncStorage.multiRemove=d,reactNative.AsyncStorage.multiMerge=y,g=!1)}}}}},DEFAULT_CONTENT_TYPES_RX=/^(image)\/.*$/i,DEFAULTS$2={},networking=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var r=Object.assign({},DEFAULTS$2,e),n=r.ignoreContentTypes||DEFAULT_CONTENT_TYPES_RX,o=1e3,a={};return XHRInterceptor.setSendCallback(function(e,n){r.ignoreUrls&&r.ignoreUrls.test(n._url)?n._skipReactotron=!0:(o++,n._trackingName=o,a[o]={data:e,xhr:n,stopTimer:t.startTimer()})}),XHRInterceptor.setResponseCallback(function(e,r,o,i,c,s){if(!s._skipReactotron){var u=s._trackingName,l=a[u]||{};a[u]=null;var f=l.data,p=l.stopTimer,v={url:i||l.xhr._url,method:s._method||null,data:f,headers:s._headers||null},m=s.responseHeaders&&s.responseHeaders["content-type"]||s.responseHeaders&&s.responseHeaders["Content-Type"]||"",d=function(r){var n="~~~ skipped ~~~";if(r&&r.length)try{n=JSON.parse(r)}catch(e){n=o}var a={body:n,status:e,headers:s.responseHeaders||null};t.apiResponse(v,a,p())};if("string"!=typeof o&&"object"!==(void 0===o?"undefined":_typeof(o))||n.test(m||""))d("");else if("blob"===c&&"undefined"!=typeof FileReader){var y=new FileReader;y.addEventListener("loadend",function e(){d(y.result),y.removeEventListener("loadend",e)}),y.readAsText(o)}else d(o)}}),XHRInterceptor.enableInterception(),{}}},StorybookSwitcher=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={showStorybook:!1},e.emitter.on("storybook",function(e){r.setState({showStorybook:e})}),r}return inherits(t,e),createClass(t,[{key:"render",value:function(){var e=this.state.showStorybook,t=this.props,r=t.storybookUi,n=t.children;return React__default.createElement(reactNative.View,{style:{flex:1}},e?React__default.createElement(r,null):n)}}]),t}(React.Component);StorybookSwitcher.propTypes={storybookUi:PropTypes.func,emitter:PropTypes.object.isRequired};var storybook=function(){return function(e){var t=mitt();return{onCommand:function(e){"storybook"===e.type&&t.emit("storybook",e.payload)},features:{storybookSwitcher:function(e){return function(r){return function(n){return React__default.createElement(StorybookSwitcher,{storybookUi:e,emitter:t},React__default.createElement(r,n))}}}}}}},NativeModules$1=require("react-native").NativeModules;function getByRemoteConfig(e){var t="undefined"!=typeof window&&window.__fbBatchedBridgeConfig&&window.__fbBatchedBridgeConfig.remoteModuleConfig;if(!Array.isArray(t)||"localhost"!==e&&"127.0.0.1"!==e)return e;var r=(t.find(getConstants)||[])[1];return r?(r.ServerHost||e).split(":")[0]:e}function getConstants(e){return e&&("AndroidConstants"===e[0]||"PlatformConstants"===e[0])}var getHost=function(e){if("object"!==("undefined"==typeof __fbBatchedBridge?"undefined":_typeof(__fbBatchedBridge))||"localhost"!==e&&"127.0.0.1"!==e)return e;e=getByRemoteConfig(e);var t=console.warn;return console.warn=function(){if(!(arguments[0]&&arguments[0].indexOf("Requiring module 'NativeModules' by name")>-1))return t.apply(console,arguments)},"undefined"!=typeof window&&window.__DEV__&&"function"==typeof window.require?(console.warn=t,e):e};function getReactNativeVersion(){try{if(!reactNative.NativeModules.PlatformConstants)return;if(!reactNative.NativeModules.PlatformConstants.reactNativeVersion)return;var e=reactNative.NativeModules.PlatformConstants.reactNativeVersion.major,t=reactNative.NativeModules.PlatformConstants.reactNativeVersion.minor,r=reactNative.NativeModules.PlatformConstants.reactNativeVersion.patch,n=reactNative.NativeModules.PlatformConstants.reactNativeVersion.prerelease;if("number"!=typeof e)return;var o=[];return o.push(e+"."+t+"."+r),n&&o.push("-"+n),o.join("")}catch(e){}}function getReactNativeDimensions(){try{var e=reactNative.Dimensions.get("screen"),t=reactNative.Dimensions.get("window");return{screenWidth:Math.ceil(e.width),screenHeight:Math.ceil(e.height),screenScale:e.scale,screenFontScale:e.fontScale,windowWidth:Math.ceil(t.width),windowHeight:Math.ceil(t.height),windowScale:t.scale,windowFontScale:t.fontScale}}catch(e){}}var _this=void 0,constants=reactNative.NativeModules.PlatformConstants||{},REACTOTRON_ASYNC_CLIENT_ID="@REACTOTRON/clientId",DEFAULTS={createSocket:function(e){return new WebSocket(e)},host:getHost("localhost"),port:9090,name:"React Native App",environment:process.env.NODE_ENV||(__DEV__?"development":"production"),client:_extends({reactotronLibraryName:"reactotron-react-native",reactotronLibraryVersion:"2.1.0",platform:reactNative.Platform.OS,platformVersion:reactNative.Platform.Version,osRelease:constants.Release,model:constants.Model,serverHost:constants.ServerHost,forceTouch:constants.forceTouchAvailable||!1,interfaceIdiom:constants.interfaceIdiom,systemName:constants.systemName,uiMode:constants.uiMode,serial:constants.Serial,androidId:constants.androidID,reactNativeVersion:getReactNativeVersion()},getReactNativeDimensions()),getClientId:function(){var e=asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",reactNative.AsyncStorage.getItem(REACTOTRON_ASYNC_CLIENT_ID));case 1:case"end":return e.stop()}},e,_this)}));return function(){return e.apply(this,arguments)}}(),setClientId:function(e){return reactNative.AsyncStorage.setItem(REACTOTRON_ASYNC_CLIENT_ID,e)}},reactotron=reactotronCoreClient.createClient(DEFAULTS);reactotron.useReactNative=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!1!==e.errors&&reactotron.use(trackGlobalErrors(e.errors)),!1!==e.editor&&reactotron.use(openInEditor(e.editor)),!1!==e.overlay&&reactotron.use(overlay()),!1!==e.asyncStorage&&reactotron.use(asyncStorage(e.asyncStorage)),!1!==e.networking&&reactotron.use(networking(e.networking)),!1!==e.storybook&&reactotron.use(storybook()),reactotron},exports.trackGlobalErrors=trackGlobalErrors,exports.openInEditor=openInEditor,exports.overlay=overlay,exports.asyncStorage=asyncStorage,exports.networking=networking,exports.storybook=storybook,exports.default=reactotron;
